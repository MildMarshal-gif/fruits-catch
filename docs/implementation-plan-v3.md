# 改善実装プラン v3（v2再レビュー反映版）

- 対象要件: `これはメモ.md`（REQ-01〜REQ-09）
- 参照レビュー: `docs/implementation-plan-v2-review.md`
- 作成日: 2026-02-07

## 0. 先に結論

- v3では、v2レビュー指摘の「工数定義とWBS合計の不一致」を解消した。
- 工数は `WBS実作業46h + バッファ2h = 最終48h` に一本化した。

## 1. レビュー反映サマリ

| 指摘 | v3での反映 |
|---|---|
| 工数の定義とWBS合計が不一致 | 工数式を `46h + 2h = 48h` に統一。本文・表・フェーズ合計を同一値へ更新 |
| 小計/バッファ/最終合計の分離不足 | 3層（小計46h、バッファ2h、最終48h）を固定し、全セクションで同じ表現を使用 |

## 2. ゴールと完了条件（DoD）

**ゴール**
- REQ-01〜REQ-09を、既存ゲーム体験を壊さずに実装完了する。

**DoD（全体）**
- 全REQがQAシナリオでPass。
- プレイ不能バグ0件（開始不可、クラッシュ、スコア停止、当たり判定破綻）。
- 参照画像固定要件を満たす。
  - REQ-07: `docs/attachments/fever-score-reference.png`
  - REQ-09: `docs/attachments/fever-sky-reference.jpg`

**REQ-01専用DoD（可読性 + デザイン維持）**
- 可読性:
  - HUD主要情報（スコア/ライフ/フィーバー残り時間）を5秒以内で判読できる。
  - 背景と重なる主要テキストにアウトラインまたはシャドウを適用し、明度差を確保する。
- デザイン維持:
  - 既存のポップで明るい世界観を維持する。
  - レビュアー確認で「雰囲気維持」「読みやすさ向上」の2項目が両方OK。

## 3. スコープと工数（最終確定）

**対象ファイル**
- 主対象: `index.html`

**工数定義（固定）**

| 区分 | 内訳 | 時間 |
|---|---|---:|
| 実装準備 | Phase 0 | 2h |
| 実装 | Phase 1-4 | 36h |
| QA/修正 | Phase 5 | 8h |
| 小計（WBS実作業） | Phase 0-5 合計 | 46h |
| バッファ | 予備（約4.3%） | 2h |
| 最終総工数 | 小計 + バッファ | 48h |

## 4. 変更対象マップ（現行コード実在名）

| 対象 | 関連箇所 |
|---|---|
| REQ-01 フォント/可読性 | `index.html`（CSS変数、HUDタイポグラフィ） |
| REQ-02 被ダメージ段階化 | `index.html:1210` `triggerLifeDamageEffect` |
| REQ-03 ライフ1常時演出 | `index.html:1210` `triggerLifeDamageEffect`、ライフ状態参照箇所 |
| REQ-04 ダメージアイテム追加 | `index.html:1856` `spawnObject`、衝突処理 |
| REQ-05 バスケット視認性 | バスケット描画処理（Draw basket） |
| REQ-06 当たり判定整合 | `index.html:1837` `intersectsObjBasket`、`index.html:1829` `intersectsCircleRect` |
| REQ-07 フィーバースコア表示 | `index.html:1225` `updateScorePulseStyles`、`index.html:1199` `updateScoreCardState` |
| REQ-08 フルーツ視認性 | `index.html:1920` `getFruitStyle`、フルーツ描画処理 |
| REQ-09 フィーバー中の空演出 | `index.html:2290` `drawFeverBackdrop`、`index.html:2496` `drawNightCityBackdrop` |
| ライフUI更新 | `index.html:1677` `updateHearts` |

## 5. マイルストーン

| # | マイルストーン | 目安 | 成果物 | 成功条件 |
|---|---|---|---|---|
| 1 | 基礎視認性・判定整合 | Day 1 | REQ-01/05/06実装 | 可読性向上 + 当たり判定ズレ解消 |
| 2 | 被ダメージ系完了 | Day 2 | REQ-02/03/04実装 | 段階演出 + ダメージアイテム確認 |
| 3 | フィーバー演出完了 | Day 3 | REQ-07/09実装 | 参照画像方向に一致 |
| 4 | フルーツ改善完了 | Day 4 | REQ-08実装 | 遠目識別性が向上 |
| 5 | QA/修正完了 | Day 5-6 | テスト結果 + 最終調整 | 全REQ Pass、重大バグ0 |

## 6. 実装フェーズ（WBS）

## Phase 0: 受け入れ条件固定（2h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ別チェック項目の確定 | 1h | - | REQ-01〜09の合否文が確定 |
| 参照画像観察軸（色/輪郭/発光）固定 | 1h | - | REQ-07/09の判断基準が文章化 |

## Phase 1: 視認性と判定の土台（10h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-01 フォント可読性調整 | 3h | Phase 0 | REQ-01 DoDを満たす |
| REQ-05 バスケット視認性改善 | 3h | Phase 0 | 背景差に関係なく見失いにくい |
| REQ-06 当たり判定一致化 | 4h | REQ-05 | 見た目外ヒット/すり抜けが解消 |

## Phase 2: 被ダメージ体験の改修（11h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-02 演出段階化（ライフ依存） | 4h | Phase 1 | ライフ3/2/1で演出差が明確 |
| REQ-03 ライフ1常時ダメージ演出 | 3h | REQ-02 | ライフ1中は危険状態を常時視認 |
| REQ-04 ダメージアイテム追加 | 4h | REQ-06 | 出現/衝突/減ライフが正常動作 |

## Phase 3: フィーバー演出改修（10h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-07 スコア表示改修（発光・輪郭・倍率） | 5h | Phase 1 | 参照画像方向の演出に一致 |
| REQ-09 空演出改修（丘維持、空のみ変更） | 5h | Phase 1 | 丘据え置き、空だけ変更成立 |

## Phase 4: フルーツ視認性改修（5h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-08 フルーツ視認性改善 | 4h | Phase 1 | 中距離/遠距離で識別しやすい |
| 全体バランス微調整 | 1h | Phase 2-4 | プレイ感破綻なし |

## Phase 5: QAと修正（8h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| シナリオ実行（全REQ） | 3h | Phase 2-4 | シナリオ結果が記録される |
| 不具合修正（優先度High/Med） | 3h | シナリオ実行 | High=0、Medは許容条件内 |
| 回帰確認 | 2h | 不具合修正 | 修正箇所の副作用なし |

**WBS実作業合計**
- `2h + 10h + 11h + 10h + 5h + 8h = 46h`

## 7. QA専用計画（シナリオ/手順/合否）

| ID | 対応REQ | 手順（再現） | 期待結果（Pass条件） |
|---|---|---|---|
| QA-01 | REQ-01 | 通常時→フィーバー時→ゲームオーバーを連続確認 | HUD主要情報を即読でき、世界観が崩れない |
| QA-02 | REQ-02 | 意図的に被弾しライフ3→2→1を確認 | 演出強度が段階的に上がる |
| QA-03 | REQ-03 | ライフ1で15秒以上生存 | 常時危険演出が維持される |
| QA-04 | REQ-04 | 複数回プレイしてダメージアイテム接触 | 接触で減ライフし、演出が発火 |
| QA-05 | REQ-05 | 明るい背景/暗め背景でバスケット追従 | 位置を見失わない |
| QA-06 | REQ-06 | バスケット端にかすめる軌道で接触テスト | 見た目と判定のズレが目立たない |
| QA-07 | REQ-07 | フィーバー突入中にスコア加算を連続確認 | 発光感・輪郭・倍率強調が確認できる |
| QA-08 | REQ-08 | 中距離/遠距離で複数果物を観察 | 種別識別が改善している |
| QA-09 | REQ-09 | 通常→フィーバー遷移で背景比較 | 丘は維持、空だけ変化する |

**合否判定ルール**
- Pass: 期待結果を満たす
- Fail: 1項目でも満たさない
- リリース可否: High不具合0件、REQ単位でFail 0件

## 8. 依存関係

```text
Phase 0
  -> Phase 1 (REQ-01/05/06)
      -> Phase 2 (REQ-02/03/04)
      -> Phase 3 (REQ-07/09)
      -> Phase 4 (REQ-08)
Phase 2 + Phase 3 + Phase 4
  -> Phase 5 (QA/修正)
```

## 9. リスクと緩和策

| リスク | 影響 | 確率 | 緩和策 |
|---|---|---|---|
| 単一ファイル集中編集で回帰 | 高 | 中 | REQ単位で小分け実装し都度確認 |
| 演出強化で可読性悪化 | 中 | 中 | REQ-01 DoDをゲート化して先に判定 |
| 当たり判定修正で難易度変動 | 中 | 中 | 5分プレイを複数回実施して補正 |
| 参照画像寄せで既存世界観が崩れる | 中 | 低 | REQ-09は「丘固定」を先に実装制約化 |

## 10. 実行順（推奨）

1. REQ-01/05/06（基盤）
2. REQ-02/03/04（被ダメージ系）
3. REQ-07/09（フィーバー系）
4. REQ-08（フルーツ仕上げ）
5. QAシナリオ実行と最終修正

