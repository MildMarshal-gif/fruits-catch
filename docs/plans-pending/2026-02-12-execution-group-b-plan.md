# 2026-02-12 実行グループB 実装計画

## 1. 目的
- 残りライフ1で「危機感は伝えるが操作と視認を邪魔しない」瀕死演出を追加し、ミス回避の気づきを強化する。
- スタート画面の説明文を短文化し、意味を維持したまま表示行数と視認性を改善する。

## 2. スコープ
- 対象: 実行グループBの2件のみ（瀕死演出、スタート説明文短文化）。
- 非対象: ゲーム難易度調整、当たり判定、スコア計算、音声アセット追加、画面構成の大規模変更。
- 影響ファイル候補:
  - `scripts/game.js`（瀕死演出の描画・更新制御）
  - `scripts/ui.js`（スタート説明文の文言定義）
  - `index.html`（初期表示文言の同期）
  - `styles/main.css`（瀕死時のUIクラス演出・可読性調整）

## 3. 変更タスク一覧（優先順）
1. 瀕死演出の仕様確定（可読性優先）
- 既存の `drawCriticalLifeOverlay` / `.wrap.life-critical` / `.hearts.life-critical` をベースに、強度上限を定義する。
- 方針: 画面中央は見やすさ維持、周辺部中心に演出、点滅周期は長め、`prefers-reduced-motion` で弱化。
- 完了条件: 色・透明度・周期・適用条件（`running && !paused && !gameOver && livesLeft===1`）が明文化される。

2. 瀕死演出のロジック整理
- `scripts/game.js` で瀕死オーバーレイ強度を定数化し、通常時/瀕死時/被弾直後の優先度を整理する。
- `triggerLifeDamageEffect` との干渉を抑える（赤フラッシュと常時警告が重なりすぎないよう減衰バランスを取る）。
- 完了条件: 瀕死時の視覚サインが一貫し、情報過多にならない。

3. 瀕死演出のCSS調整
- `styles/main.css` の `.wrap.life-critical` と `.hearts.life-critical` を、過剰なサチュレーション/揺れにならない値へ調整。
- `@media (prefers-reduced-motion: reduce)` に瀕死演出の抑制ルールを追加。
- 完了条件: HUD文字・落下物の視認性を保ったまま、危機状態が判別できる。

4. スタート説明文の短文化案適用
- `scripts/ui.js` の `resetOverlayTextToStart` と `index.html` の初期 `.how` を同じ短文へ統一。
- 意味維持条件:
  - 操作方法（左右移動）
  - 片手・指1本で遊べる点
  - 3ミスで終了
  - 星でフィーバー2倍
- 完了条件: 行数減少（目安 4行→2〜3行）と意味保持を両立。

5. 文言表示バランス最終調整
- 行間・余白・改行位置を `styles/main.css` の `.how` で微調整し、スマホ表示での一読性を担保。
- 完了条件: 折返しが不自然にならず、開始前の情報把握が速くなる。

## 4. 実装順序（1回処理向け）
1. 仕様固定
- 瀕死演出の強度レンジと短文化文言を先に確定（手戻り防止）。

2. ロジック実装
- `scripts/game.js` の瀕死演出制御を更新し、`running/paused/gameOver/life` 条件を整理。

3. スタイル実装
- `styles/main.css` の life-critical 系と reduced-motion 分岐を調整。

4. 文言実装
- `scripts/ui.js` と `index.html` の `.how` 文言を統一短文化。

5. 目視確認
- デスクトップ/モバイル幅で瀕死演出と説明文レイアウトを確認し、必要なら軽微調整。

## 5. テスト計画
- 機能確認（瀕死演出）
  - ライフ2: caution状態のみ、瀕死演出は未発火。
  - ライフ1: 瀕死演出が常時出るが、落下物・HUD数値が判読可能。
  - ライフ0（ゲームオーバー）: 瀕死演出が残留しない。
  - 一時停止中: 瀕死演出が実質停止/抑制される。

- 体験確認（妨害バランス）
  - 30秒プレイして、演出で目が疲れないか・落下物追跡を阻害しないか確認。
  - `prefers-reduced-motion: reduce` で点滅/アニメが弱化されることを確認。

- 文言確認（短文化）
  - 初期表示とリセット後表示で同一文言になっている。
  - 意味4点（操作、片手、3ミス終了、星2倍）を保持。
  - スマホ幅で行数と可読性が改善している。

## 6. リスクと対策
- リスク: 警告演出が強すぎてプレイ妨害になる。
- 対策: 透明度上限・周期を低刺激側に固定し、中心領域の彩度変化を抑える。

- リスク: 被弾フラッシュと瀕死演出が重なり視認性低下。
- 対策: 被弾時のみ一時優先、常時瀕死側は減衰補正で重畳を軽くする。

- リスク: 文言短縮でニュアンス欠落。
- 対策: 4要件チェックリストでレビューし、欠落があれば文言を再調整。

- リスク: `index.html` と `scripts/ui.js` の文言不一致再発。
- 対策: 同一文言を1セットで同時更新し、確認手順に「初期表示/リセット表示一致」を固定。

## 7. 要確認事項
- 瀕死演出の見た目優先度: 「危機感強め」か「妨害最小」か、どちらを基準にするか。
- reduced-motion 時の扱い: 完全停止か、低強度表示を残すか。
- スタート説明文のトーン: 現在のカジュアル路線を維持するか、より簡潔な事務的トーンに寄せるか。
- 文言行数目標: 2行固定か、端末幅で2〜3行許容か。

## 実装依頼用プロンプト
```text
fruits-catch の実行グループBを1回の実装処理でまとめて対応して。

対象:
1) 残りライフ1時の瀕死演出追加/調整
2) スタート画面の説明文短文化

要件:
- まだ未変更の既存コード方針を尊重し、影響を最小化
- 瀕死演出は可読性とプレイ妨害のバランス最優先
  - 条件は running && !paused && !gameOver && livesLeft===1
  - 既存の drawCriticalLifeOverlay / .wrap.life-critical / .hearts.life-critical を活用
  - 被弾フラッシュとの重なりは視認性が落ちないよう制御
  - prefers-reduced-motion で演出を弱化
- 文言短縮は意味を落とさない
  - 操作方法、片手プレイ、3ミス終了、星で2倍 を保持
  - index.html と scripts/ui.js の文言を一致させる
  - 表示行数と視認性を改善（目安 4行→2〜3行）

想定変更ファイル:
- scripts/game.js
- styles/main.css
- scripts/ui.js
- index.html

作業順:
1. 瀕死演出仕様の定数化/条件整理
2. game.js 実装
3. main.css 調整（life-critical + reduced-motion）
4. ui.js と index.html の文言統一短文化
5. 目視確認と微調整

確認項目:
- ライフ1で瀕死演出が出るが、落下物/HUDは読みやすい
- ライフ0やポーズ中に不適切な残留演出がない
- reduced-motion で刺激が抑えられる
- 初期表示とリセット後で説明文が一致
- スマホ表示で行数と可読性が改善

完了条件:
- 2項目（瀕死演出、説明文短文化）が同一PR/同一実装で完了
- 上記確認項目を満たし、見た目/挙動の回帰がない
```
