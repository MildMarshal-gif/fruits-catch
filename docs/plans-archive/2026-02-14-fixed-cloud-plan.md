# 雲を3つ固定で常時表示する実装プラン（ぷかぷか版）

## Summary
- `scripts/game.js` の雲描画を「可変数・消失点移動」から「3つ固定・常時表示・画面内ぷかぷか」に置換する。
- 雲は画面外へ出さず、フィーバー中は少し明るくする。
- 背景画像モード/フォールバックモードのどちらでも同じ方針で表示する。

## Public APIs / Interfaces
- 外部API変更なし。
- 変更対象は `scripts/game.js` のみ。
- 変更対象関数は `drawParallaxCloudLayer(now, dynamicFx, feverIntensity)` と `drawBackground()` の呼び出し整合確認のみ。

## Implementation Details
1. `drawParallaxCloudLayer()` の `cloudCount` 可変ロジックを廃止し、内部で常に3雲を描画する。
2. 3雲の基準位置を上段等間隔で固定する。  
   `x = [0.22w, 0.50w, 0.78w]`、`y = [0.20h, 0.16h, 0.22h]` を採用する。
3. 3雲それぞれに固定位相を持たせ、時間で左右・上下に揺らす。  
   `x += sin(t * sx + phase) * ax`、`y += cos(t * sy + phase) * ay`。
4. ぷかぷか量は「中くらい」で実装する。  
   初期値は `ax=18px`, `ay=12px`（解像度比でスケール）とする。
5. `reducedMotionQuery.matches` のときは揺れ量・速度を 55% に下げる（表示数は3維持）。
6. 雲は画面外に出さない。  
   描画前に `x,y` を雲の描画サイズに応じて clamp する。
7. 画像雲が3枚揃っている場合は `cloud_01/02/03` を固定対応で描画する（ローテーションなし）。
8. 雲画像が1枚でも未ロードなら、楕円雲フォールバックを3つ固定で描画する。
9. 雲サイズは固定ベース（例: `0.17w`, `0.15w`, `0.16w`）を使い、微小脈動のみ許可する。  
   脈動は `1.0 ± 0.04` 以内に制限する。
10. アルファは常時可視にする。  
    通常時ベース `0.30/0.28/0.26`、下限は `0.20` に固定し 0 まで落とさない。
11. フィーバー時は雲を少し明るくする。  
    `feverIntensity` に応じて `+0.10` までアルファ上乗せ、色は `#ffffff -> #fffdf2` に軽く寄せる。
12. 既存の夜景/モート/背景フィーバーFXの ON/OFF ポリシーは変更しない。
13. `drawBackground()` で `drawParallaxCloudLayer()` が常時呼ばれていることを維持し、条件分岐で消えないことを確認する。
14. `drawParallaxCloudLayer()` 内の旧「吸い込み進行」「scale減衰」「alpha消失」計算を削除する。

## Test Cases
1. 通常時表示  
   開始直後から雲3つが見え、上段で画面内に留まりながらぷかぷか動く。
2. 常時表示確認  
   60秒放置しても雲が画面外へ消えない。
3. フィーバー時表示  
   フィーバー中も雲3つが表示継続し、通常時より少し明るく見える。
4. 画像モード確認  
   背景画像読み込み時にも雲3つが同様に表示される。
5. 雲画像欠損フォールバック  
   `cloud_01_v1.png` をブロックしても楕円雲3つが同じ配置・同じぷかぷかで表示される。
6. `?quality=performance` / `prefers-reduced-motion`  
   表示数は3固定のまま、揺れ量と速度だけ減衰し、描画破綻なし。
7. コンソール確認  
   新規エラーなし（既知の `favicon.ico` 404 は除外）。

## Assumptions & Defaults
- 「画面から消さない」は「雲中心とサイズを考慮して常に可視領域内に clamp する」と定義する。
- 「3つ固定」は雲ID固定（`cloud_01/02/03`）と位置固定（上段等間隔）を意味する。
- 背景演出ポリシー（夜景/モート/背景フィーバーFX）は現状維持で、今回の対象は雲挙動のみ。
