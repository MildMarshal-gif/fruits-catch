# 改善実装プラン（`これはメモ.md`対応）

## 1. ゴールと完了条件

**ゴール**
- `これはメモ.md`のREQ-01〜REQ-09を、既存ゲーム体験を壊さずに実装する。

**完了条件（Definition of Done）**
- REQ-01〜09の各要件に対し、実装と目視確認チェックが完了している。
- 添付資料参照が必要な要件（REQ-07, REQ-09）は、`docs/attachments`の方向性に一致している。
- プレイ不能バグ（開始不可、クラッシュ、スコア更新停止、当たり判定破綻）が0件。

## 2. スコープと前提

- 主変更対象: `index.html`（CSS・描画・ゲームロジックが同居）
- 参照資料:
  - REQ-07: `docs/attachments/fever-score-reference.png`
  - REQ-09: `docs/attachments/fever-sky-reference.jpg`
- 体制仮定: 実装1名、レビュー1名
- 見積: 約40時間（実装32h + 検証/調整8h）+ バッファ20%

## 3. 変更対象マップ（現行コード）

- UIフォント/可読性: `index.html`（CSS変数・HUDタイポグラフィ周辺）
- ダメージ演出: `index.html`（`triggerDamageFeedback`付近）
- ライフ表示: `index.html`（`renderLives`付近）
- 当たり判定: `index.html`（`isColliding`付近）
- オブジェクト生成: `index.html`（`spawnObject`付近）
- フルーツ見た目: `index.html`（`getFruitStyle`付近）
- フィーバー演出（スコア/背景）: `index.html`（`applyScorePulseVisual`, `drawFeverBackdrop`, `draw...`群）

## 4. マイルストーン

| # | マイルストーン | 目安 | 成果物 | 成功条件 |
|---|---|---|---|---|
| 1 | 基礎調整完了 | 0.5日 | 調整方針 + 初期実装 | REQ-01/05/06の基礎変更が反映 |
| 2 | 被ダメージ系完了 | 1.0日 | 演出段階化 + ダメージアイテム | REQ-02/03/04がプレイで確認可能 |
| 3 | フィーバー系完了 | 1.0日 | スコアUI + 空演出刷新 | REQ-07/09が参照画像方向に一致 |
| 4 | 視認性最終調整完了 | 0.5日 | フルーツ視認性改修 | REQ-08で遠目識別が改善 |
| 5 | QA完了 | 1.0日 | チェックリスト結果 | 全REQの受け入れ条件を満たす |

## 5. 実装フェーズ詳細

## Phase 0: 事前固定（2h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| 受け入れ基準をREQ単位で明文化 | 1h | - | REQ-01〜09に対し判定文が1行ずつある |
| 参照画像の観察ポイント定義（色/発光/輪郭） | 1h | - | REQ-07,09の実装判断軸が文章化される |

## Phase 1: UI視認性と判定整合（10h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-01 フォント可読性改善（サイズ/太さ/コントラスト再調整） | 3h | Phase 0 | HUD/ボタン/スコアの読みにくさが解消 |
| REQ-05 バスケット視認性改善（輪郭/陰影/色差） | 3h | Phase 0 | 背景に埋もれず一目で位置把握可能 |
| REQ-06 当たり判定修正（見た目サイズへ一致） | 4h | REQ-05 | 見た目外でのヒット/取りこぼしが体感で解消 |

## Phase 2: 被ダメージ演出とゲームロジック（12h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-02 被ダメージ演出の段階化（残ライフ連動） | 4h | Phase 0 | ライフ減少に応じて演出強度が段階的に上がる |
| REQ-03 ライフ1常時ダメージ演出 | 3h | REQ-02 | ライフ1中は常時「危険状態」が視認できる |
| REQ-04 ダメージアイテム追加（生成/衝突/減ライフ） | 5h | REQ-06 | 追加アイテムが自然に出現し、接触でダメージが入る |

## Phase 3: フィーバー演出刷新（11h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-07 フィーバー中スコア表示変更（発光・輪郭・倍率強調） | 6h | Phase 1 | 参照画像の方向性に沿ったスコア演出になる |
| REQ-09 フィーバー中の空演出変更（丘維持 + 空のみ変更） | 5h | Phase 1 | 丘は通常維持、空だけ参照画像方向へ変化 |

## Phase 4: フルーツ視認性と最終調整（5h）

| タスク | 工数 | 依存 | Done条件 |
|---|---:|---|---|
| REQ-08 フルーツ視認性改善（形・色差・輪郭） | 4h | Phase 1 | 遠目でも種類判別がしやすい |
| 全体バランス調整（速度/演出強度/可読性） | 1h | Phase 2,3,4 | 1プレイ通して視認と難易度が破綻しない |

## 6. 依存関係（簡易）

```text
Phase 0
  -> Phase 1 (REQ-01/05/06)
      -> Phase 2 (REQ-02/03/04)
      -> Phase 3 (REQ-07/09)
      -> Phase 4 (REQ-08)
Phase 2 + Phase 3 + Phase 4
  -> QA完了
```

## 7. 受け入れテスト観点（REQ別）

- REQ-01: 通常時/フィーバー時/ゲームオーバー画面で主要テキスト可読性を確認
- REQ-02: ライフ3→2→1で被ダメージ演出強度が段階的に上がることを確認
- REQ-03: ライフ1の間、被弾していなくても危険演出が持続することを確認
- REQ-04: ダメージアイテムの出現頻度・接触判定・ライフ減少を確認
- REQ-05: 明背景/暗背景でバスケット輪郭が埋もれないことを確認
- REQ-06: バスケット見た目端と当たり判定端のズレを目視/体感で確認
- REQ-07: フィーバー中スコア表示が発光感・輪郭・倍率強調を満たすことを確認
- REQ-08: フルーツが中距離/遠距離でも識別できることを確認
- REQ-09: フィーバー中に丘は通常維持、空のみ参照方向へ変化することを確認

## 8. リスクと対策

| リスク | 影響 | 確率 | 対策 |
|---|---|---|---|
| 単一ファイル集中編集で回帰が出る | 高 | 中 | REQごとに小さく区切って実装/確認 |
| 演出強化で可読性が逆に落ちる | 中 | 中 | 先に最小実装し、強度は段階的に上げる |
| 当たり判定調整で難易度が急変 | 中 | 中 | 判定変更後に5分プレイを複数回実施 |
| フィーバー背景変更で世界観が崩れる | 中 | 低 | 「丘固定」の制約を先にコードで分離 |

## 9. 実行順（推奨）

1. REQ-01, 05, 06（基礎視認性 + 判定整合）
2. REQ-02, 03, 04（被ダメージ系）
3. REQ-07, 09（フィーバー演出）
4. REQ-08（フルーツ仕上げ）
5. 全REQ横断QAと微調整

