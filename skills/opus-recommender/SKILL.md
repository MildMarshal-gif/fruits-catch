---
name: opus-recommender
description: |
  Analyze task complexity and recommend Opus 4.6 for truly complex tasks.
  Use when user asks about architecture design, security audit, complex debugging, or large-scale refactoring.
  Trigger keywords: アーキテクチャ, 設計, リファクタ, 構造変更, セキュリティ, 脆弱性, 監査, 原因不明, バグ調査, 非同期, 競合状態, デッドロック, メモリリーク, 大規模, 全体, プロジェクト全体, 前例のない, 新しい, 未知
  Be conservative - only recommend when Opus's superior reasoning is clearly needed.
---

# Opus Recommender

## Purpose

Opus 4.6の高度な推論能力が本当に有利な複雑なタスクでのみ、ユーザーにモデル切替を提案する。

**重要**: Proプランではトークン消費が激しいため、推奨は厳しめに判定する。疑わしい場合は推奨しない。

## Scope

### Opusを推奨すべきタスク

以下の条件に**複数**該当する場合のみ推奨:

- **アーキテクチャ設計**: 新規システム設計、大規模リファクタリング計画、技術選定
- **セキュリティ**: 脆弱性監査、セキュリティレビュー、ペネトレーションテスト設計
- **複雑なバグ調査**: 原因不明のバグ、非同期バグ、競合状態、デッドロック、メモリリーク
- **大規模変更**: 10+ファイルにまたがる変更、プロジェクト全体のリファクタリング
- **前例のない問題**: 新技術領域、未知のアルゴリズム、独自実装が必要
- **品質保証**: マージ前の最終レビュー、リリース前チェック（重要な変更のみ）

### Sonnetで十分なタスク（推奨しない）

- 単一ファイルの編集（数十行程度）
- 明確な仕様の定型的実装
- テスト作成、ドキュメント更新
- 簡単なバグ修正（原因が明確）
- コメント追加、リネーム、フォーマット修正
- 既存パターンの踏襲

## Trigger Keywords

**必須キーワード**（これらがない場合は推奨しない）:

- 設計, アーキテクチャ, リファクタ, 構造変更, 再設計
- セキュリティ, 脆弱性, 監査, ペネトレーション
- 原因不明, バグ調査, 非同期, 競合状態, デッドロック, メモリリーク
- 大規模, 全体, プロジェクト全体, 多数のファイル, 10ファイル以上
- 前例, 新しい, 未知, 初めて, アルゴリズム
- レビュー, 最終確認, マージ前, リリース前

**除外キーワード**（これらがある場合は推奨しない）:

- タイポ, typo, 修正, fix, 簡単, 単純, simple
- コメント, comment, ドキュメント, document
- テスト追加, add test
- リネーム, rename, フォーマット, format

## Workflow

1. ユーザーのタスク指示を受け取る
2. 除外キーワードの有無をチェック（あれば即終了）
3. 必須キーワードの有無をチェック（なければ即終了）
4. タスクの複雑度を分析:
   - 影響範囲（ファイル数、モジュール数）
   - 技術的難易度（新規性、前例の有無）
   - リスク（セキュリティ、パフォーマンス、データ整合性）
5. **厳しめの判定**: 以下の**すべて**に該当する場合のみ推奨
   - 必須キーワードが2つ以上含まれる
   - 影響範囲が大きい（10+ファイルまたは複数モジュール）
   - 技術的難易度が高い（新規性あり、前例なし）
   - Opus特有の強み（ARC-AGI-2で3倍のスコア）が活きる
6. 推奨する場合、理由とトークン消費の警告を提示
7. ユーザーに確認を求める
8. 承認されたら `/model opus` の実行を案内

## Output Format

### 推奨する場合

```
このタスクはOpus 4.6の方が良い成果が得られそうだ ☆

理由:
- [具体的な理由1（ベンチマークデータに基づく）]
- [具体的な理由2]

注意: Opusはトークン消費が激しい。本当に必要な複雑なタスクだけに使うことを推奨する。

Opusに切り替えるか？ `/model opus` を実行すれば切り替わる。
```

### 推奨しない場合

何も出力しない（Sonnetのまま続行）

## Evidence (Performance Data)

Opus 4.6 vs Sonnet 4.5の性能差:

- **SWE-bench Verified**: 80.9% vs 77.2% (+3.7pt) - わずかな差
- **ARC-AGI-2（新規問題推論）**: 37.6% vs 13.6% (**約3倍**) - Opusが圧倒的に有利
- **実例**: Cコンパイラ全体（100%）をOpus 4.6が設計・実装
- **速度**: Sonnetの方が41%速い（54.84 vs 38.93 tok/s）
- **コスト**: Opusは入力$5/出力$25、Sonnetは入力$3/出力$15（Opusは約1.7倍高い）

**結論**: 新規問題への推論が必要な複雑タスクでのみOpusを使う価値がある。

## Examples

### 推奨すべき例

- 「プロジェクト全体のアーキテクチャをリファクタリングして、モジュール間の依存関係を整理したい」
  - キーワード: アーキテクチャ, リファクタリング, 全体
  - 影響範囲: プロジェクト全体
  - 難易度: 高（依存関係の整理は複雑）

- 「セキュリティ監査をして脆弱性を探してほしい。特にXSS、CSRF、SQLインジェクションのリスクを確認」
  - キーワード: セキュリティ, 監査, 脆弱性
  - リスク: 高（セキュリティ）
  - 難易度: 高（複数の脆弱性パターン）

- 「原因不明の非同期バグを調査して。時々だけ発生する競合状態の問題らしい」
  - キーワード: 原因不明, 非同期, 競合状態
  - 難易度: 高（再現性低い、原因不明）

### 推奨すべきでない例

- 「READMEのタイポを修正して」
  - 除外キーワード: タイポ, 修正
  - 影響範囲: 1ファイル
  - 難易度: 低

- 「この関数にコメントを追加して」
  - 除外キーワード: コメント
  - 影響範囲: 1ファイル、数行
  - 難易度: 低

- 「簡単なバグ修正。変数名のタイプミスが原因」
  - 除外キーワード: 簡単, 修正
  - 原因明確
  - 難易度: 低

- 「テストを1つ追加して」
  - 除外キーワード: テスト追加
  - 影響範囲: 1ファイル
  - 難易度: 低

## Guardrails

- **厳しめの判定**: 疑わしい場合は推奨しない（false positiveよりfalse negativeの方がマシ）
- **トークン消費の警告**: 推奨する場合は必ず警告を含める
- **複数条件の確認**: 必須キーワード2つ以上 + 大きな影響範囲 + 高難易度のすべてを満たす場合のみ
- **除外キーワードの優先**: 除外キーワードがある場合は即座に推奨しない