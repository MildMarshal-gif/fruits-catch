:root{
      --sky-top:#57b8ff;
      --sky-mid:#9be8ff;
      --sky-bottom:#d8ffcb;
      --shell-ink:#203049;
      --shell-ink-soft:#4b627f;
      --panel:#fffdf4e8;
      --panel-strong:#fff9ec;
      --panel-border:#ffffffd1;
      --shadow-soft:0 10px 24px rgba(32,48,73,.18);
      --shadow-strong:0 24px 56px rgba(32,48,73,.28);
      --brand-pink:#ff5ba8;
      --brand-orange:#ff9e4d;
      --brand-gold:#ffd36a;
      --brand-green:#58d36b;
      --brand-blue:#56a8ff;
      --good:#2ecc98;
      --bad:#ff5f78;
      --fever-warm:#ffe38d;
      --fever-hot:#ff8abb;
      --fever-cool:#67b8ff;
      --ui-scale:1;
      --hud-scale:1;
      --title-scale:1;
      --fx-density:1;
      --fruit-scale:1;
      --basket-scale:1;
      --pause-scale:1;
      --motion-scale:1;
      --tap-target:44px;
      --hud-inset-top:14px;
      --hud-inset-side:14px;
      --text-leading:var(--font-line-height-body);
      --shell-radius:32px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }

    body{
      font-family:var(--font-family-body);
      font-weight:var(--font-weight-body);
      line-height:var(--font-line-height-body);
      display:grid;
      place-items:center;
      overflow:hidden;
      color:var(--shell-ink);
      background:
        radial-gradient(1300px 650px at -6% -8%, #ffffffc9 0 36%, transparent 37%),
        radial-gradient(1100px 560px at 108% 6%, #fff7d9bf 0 38%, transparent 39%),
        linear-gradient(180deg, var(--sky-top) 0%, var(--sky-mid) 54%, var(--sky-bottom) 100%);
    }

    body::before,
    body::after{
      content:"";
      position:fixed;
      inset:auto;
      pointer-events:none;
      z-index:0;
      opacity:.45;
      filter:blur(0.2px);
      animation:skyDrift 16s linear infinite;
    }

    body::before{
      width:min(44vw, 640px);
      height:min(24vw, 340px);
      left:-6vw;
      top:6vh;
      background:
        radial-gradient(circle at 18% 44%, #ffffffd8 0 20%, transparent 21%),
        radial-gradient(circle at 54% 50%, #ffffffda 0 26%, transparent 27%),
        radial-gradient(circle at 82% 44%, #ffffffd2 0 20%, transparent 21%);
    }

    body::after{
      width:min(36vw, 520px);
      height:min(20vw, 300px);
      right:-2vw;
      top:14vh;
      background:
        radial-gradient(circle at 20% 52%, #fff7dcdd 0 22%, transparent 23%),
        radial-gradient(circle at 56% 44%, #ffffffd1 0 28%, transparent 29%),
        radial-gradient(circle at 86% 58%, #fffce8d8 0 18%, transparent 19%);
      animation-duration:21s;
      animation-direction:reverse;
    }

    .wrap{
      width:min(1060px, 96vw);
      aspect-ratio:16 / 9;
      position:relative;
      z-index:1;
      overflow:hidden;
      border-radius:var(--shell-radius);
      border:2px solid #ffffffb3;
      box-shadow:var(--shadow-strong);
      background:
        linear-gradient(180deg, #ffffff54, #ffffff14),
        linear-gradient(155deg, #fff9ec77 0%, #ffffff10 56%, #d2efff21 100%);
      backdrop-filter:blur(8px);
    }

    .wrap::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(66% 48% at 10% 0%, #ffffff55 0, transparent 70%),
        radial-gradient(64% 46% at 90% 0%, #ffefbd33 0, transparent 72%);
      mix-blend-mode:screen;
      pointer-events:none;
    }

    canvas{
      width:100%;
      height:100%;
      display:block;
    }

    .hud{
      position:absolute;
      inset:
        calc(var(--hud-inset-top) + env(safe-area-inset-top))
        var(--hud-inset-side)
        auto
        var(--hud-inset-side);
      display:grid;
      grid-template-columns:minmax(0, 1fr) auto;
      gap:calc(10px * var(--hud-scale));
      align-items:start;
      pointer-events:none;
      text-shadow:
        0 1px 0 rgba(255,255,255,.7),
        0 2px 6px rgba(25,40,60,.16);
    }

    .hud-main{
      display:grid;
      grid-template-columns:repeat(2, minmax(0, 1fr));
      gap:calc(10px * var(--hud-scale));
      min-width:0;
    }

    .stat-card{
      min-height:calc(74px * var(--hud-scale));
      border-radius:20px;
      border:2px solid var(--panel-border);
      background:var(--panel);
      box-shadow:var(--shadow-soft);
      backdrop-filter:blur(2px);
      padding:calc(10px * var(--hud-scale)) calc(12px * var(--hud-scale));
      display:grid;
      gap:4px;
      align-content:center;
      min-width:0;
    }

    .stat-label{
      font-size:calc(12px * var(--hud-scale));
      line-height:1.2;
      font-weight:var(--font-weight-heading-sub);
      letter-spacing:.9px;
      text-transform:uppercase;
      color:var(--shell-ink-soft);
      opacity:.9;
      text-shadow:
        0 1px 0 rgba(255,255,255,.76),
        0 2px 6px rgba(25,40,60,.18);
    }

    .stat-value{
      display:inline-flex;
      align-items:center;
      min-height:calc(32px * var(--hud-scale));
      gap:8px;
      min-width:0;
      font-weight:var(--font-weight-body);
      line-height:1;
      font-size:calc(30px * var(--hud-scale));
      color:var(--shell-ink);
      letter-spacing:.2px;
      text-shadow:
        0 2px 0 rgba(255,255,255,.72),
        0 6px 12px rgba(25,40,60,.20);
    }

    .score-card .stat-value{
      color:#ff5b9c;
      text-shadow:
        0 2px 0 rgba(255,255,255,.84),
        0 0 12px rgba(255,129,177,.28);
    }

    .score-shell{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:8px;
      min-width:0;
      padding:3px 10px;
      border-radius:999px;
      isolation:isolate;
    }

    .score-shell::before{
      content:"";
      position:absolute;
      inset:-9px -14px;
      border-radius:999px;
      z-index:-1;
      opacity:0;
      transform:scale(.92);
      background:
        radial-gradient(90% 80% at 50% 48%, rgba(255,255,255,.86) 0%, rgba(255,255,255,.30) 52%, rgba(255,255,255,0) 100%),
        conic-gradient(from 215deg, rgba(255,132,170,.54), rgba(255,214,135,.52), rgba(106,226,198,.50), rgba(101,197,255,.54), rgba(189,158,255,.52), rgba(255,132,170,.54));
      filter:blur(2px);
      transition:opacity .18s ease, transform .18s ease;
    }

    .score-card.is-fever .score-shell::before{
      opacity:1;
      transform:scale(1);
      animation:scoreAuraPulse 1.1s ease-in-out infinite;
    }

    .score-multiplier{
      display:none;
      align-items:center;
      justify-content:center;
      min-width:2.4ch;
      padding:2px 9px 3px;
      border-radius:999px;
      border:2px solid rgba(104,101,116,.72);
      background:linear-gradient(180deg, #fffef8, #ece9e2);
      color:#5b5664;
      font-size:calc(16px * var(--hud-scale));
      line-height:1;
      font-weight:var(--font-weight-body);
      letter-spacing:.2px;
      box-shadow:
        0 2px 0 rgba(255,255,255,.95) inset,
        0 2px 8px rgba(28,35,53,.18);
      transform-origin:center;
      transform:translateY(0) scale(1);
      transition:transform .1s linear, filter .1s linear;
    }

    .score-multiplier.show{
      display:inline-flex;
    }

    .score-card.is-fever #score{
      color:#6de4ff;
      -webkit-text-stroke:2px rgba(57,167,233,.78);
      paint-order:stroke fill;
      text-shadow:
        0 0 8px rgba(175,255,255,.74),
        0 0 20px rgba(112,255,210,.46),
        0 0 34px rgba(124,169,255,.44);
    }

    .score-card.is-fever .score-multiplier{
      border-color:#8b8993;
      box-shadow:
        0 2px 0 rgba(255,255,255,.95) inset,
        0 0 14px rgba(255,255,255,.46),
        0 4px 10px rgba(28,35,53,.24);
    }

    .score-card.is-fever{
      border-color:#fff8d2;
      background:
        linear-gradient(118deg, #fff8db 0%, #ffe5ef 48%, #dff2ff 100%);
      box-shadow:
        0 0 0 1px #ffffffb8 inset,
        0 14px 28px rgba(32,48,73,.2),
        0 0 28px rgba(255,182,122,.34);
      animation:scoreFeverGlow 1.05s ease-in-out infinite;
    }

    .score-card.is-fever .stat-label{
      color:#8852bf;
      letter-spacing:1.2px;
    }

    #score{
      display:inline-block;
      min-width:2ch;
      transform-origin:center;
      transition:transform .09s linear, text-shadow .09s linear, color .18s ease, filter .1s linear;
      white-space:nowrap;
    }

    .hearts{
      display:flex;
      align-items:center;
      flex-wrap:nowrap;
      gap:calc(6px * var(--hud-scale));
      min-width:fit-content;
      min-height:calc(24px * var(--hud-scale));
    }

    .life-heart{
      width:calc(24px * var(--hud-scale));
      height:calc(24px * var(--hud-scale));
      border-radius:8px;
      border:2px solid #e62f63;
      background:linear-gradient(180deg, #ffd8e5, #ffc0d9);
      color:#b61544;
      display:grid;
      place-items:center;
      font-size:calc(13px * var(--hud-scale));
      line-height:1;
      font-weight:900;
      box-shadow:0 5px 10px rgba(230,47,99,.18);
    }

    .life-heart.off{
      border-color:#93a4bd;
      background:linear-gradient(180deg, #edf1f8, #d9e1ee);
      color:#71839e;
      box-shadow:none;
    }

    .hearts.hit .life-heart.on{
      animation:lifeHitPulse .35s ease-out 2;
    }

    .hud-side{
      display:grid;
      gap:calc(8px * var(--hud-scale));
      justify-items:end;
      pointer-events:none;
    }

    .btns{
      display:flex;
      gap:calc(8px * var(--hud-scale));
      flex-wrap:wrap;
      justify-content:flex-end;
      pointer-events:auto;
    }

    button{
      cursor:pointer;
      border:none;
      border-radius:999px;
      min-height:var(--tap-target);
      min-width:var(--tap-target);
      padding:calc(10px * var(--ui-scale)) calc(16px * var(--ui-scale));
      font-family:var(--font-family-body);
      font-size:calc(14px * var(--ui-scale));
      line-height:var(--font-line-height-body);
      font-weight:var(--font-weight-button);
      color:var(--shell-ink);
      background:linear-gradient(180deg, #fffef9, #ffeeda);
      box-shadow:0 8px 18px rgba(32,48,73,.2);
      border:2px solid #ffffffd8;
      transition:transform .09s ease, box-shadow .15s ease, filter .15s ease;
      touch-action:manipulation;
    }

    button:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 22px rgba(32,48,73,.24);
      filter:saturate(1.03);
    }

    button:active{ transform:translateY(1px) scale(.992); }

    button:disabled{
      opacity:.65;
      cursor:default;
      transform:none;
      box-shadow:0 4px 10px rgba(32,48,73,.14);
      filter:none;
    }

    button:focus-visible{
      outline:3px solid #245b99;
      outline-offset:2px;
    }

    .badge{
      display:none;
      align-items:center;
      gap:8px;
      padding:calc(10px * var(--hud-scale)) calc(12px * var(--hud-scale));
      border-radius:14px;
      background:var(--panel-strong);
      border:2px solid var(--panel-border);
      box-shadow:var(--shadow-soft);
      font-size:calc(14px * var(--hud-scale));
      line-height:var(--font-line-height-body);
      font-weight:var(--font-weight-body-strong);
      color:var(--shell-ink);
      pointer-events:none;
      max-width:min(76vw, 360px);
      width:fit-content;
      text-shadow:
        0 1px 0 rgba(255,255,255,.72),
        0 2px 6px rgba(25,40,60,.18);
    }

    .badge.show{ display:flex; }

    .badge .spark{
      font-size:calc(15px * var(--hud-scale));
      color:#ff8b4a;
      text-shadow:0 0 7px #ffed97;
    }

    .badge .badge-label{
      text-transform:uppercase;
      letter-spacing:.8px;
      opacity:.85;
    }

    .badge .badge-time{
      font-size:calc(18px * var(--hud-scale));
      color:#f25f9f;
      min-width:4ch;
      text-align:right;
    }

    .badge .badge-tail{
      opacity:.7;
      font-size:calc(12px * var(--hud-scale));
    }

    .badge.fever-neon{
      color:#2c3158;
      background:
        linear-gradient(115deg, #fff8de 0%, #ffeec4 40%, #ffe0ef 75%, #d9efff 100%);
      border-color:#fff7df;
      box-shadow:
        0 0 0 1px #ffffffb5 inset,
        0 8px 20px rgba(32,48,73,.18),
        0 0 20px rgba(255,197,132,.38);
      animation:feverBadgePulse 1.2s ease-in-out infinite;
    }

    .badge.fever-neon .badge-time{
      color:#ff4f95;
      text-shadow:0 0 8px rgba(255,142,182,.55);
    }

    .badge.fever-neon[data-phase="enter"]{ animation-duration:.9s; }
    .badge.fever-neon[data-phase="active"]{ animation-duration:1.25s; }
    .badge.fever-neon[data-phase="exit"]{ animation-duration:1.45s; opacity:.92; }

    .pause-panel{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
      background:
        radial-gradient(120% 68% at 30% 6%, #ffffff35 0%, transparent 58%),
        linear-gradient(180deg, rgba(10,20,36,0.24), rgba(10,20,36,0.62));
      z-index:3;
    }

    .pause-panel.show{
      opacity:1;
      pointer-events:auto;
    }

    .pause-card{
      width:min(520px, 92%);
      border-radius:28px;
      border:2px solid #ffffffd8;
      background:
        linear-gradient(165deg, #fffef8 0%, #ffeacd 54%, #ffe2f4 100%);
      box-shadow:var(--shadow-strong);
      padding:calc(20px * var(--ui-scale));
      text-align:center;
      color:#25405f;
    }

    .pause-title{
      margin:0;
      font-size:calc(32px * var(--title-scale));
      line-height:1.12;
      color:#294770;
      text-shadow:0 2px 0 #ffffffd5;
      letter-spacing:.5px;
    }

    .pause-desc{
      margin:12px 0 14px;
      font-size:calc(14px * var(--ui-scale));
      font-weight:var(--font-weight-body);
      line-height:var(--font-line-height-body);
      color:#365a84;
    }

    .pause-actions{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:10px;
    }

    #resumeBtn{
      background:linear-gradient(100deg, #ff7cb8 0%, #ffc76a 52%, #ffe98f 100%);
      color:#1f3152;
    }

    #pauseRestartBtn{
      background:linear-gradient(180deg, #f6fbff, #e4f2ff);
      color:#24486a;
    }

    .overlay{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      background:
        radial-gradient(130% 78% at 20% 0%, #ffffff50 0%, transparent 54%),
        linear-gradient(180deg, #15305022, #15305068 80%, #10273f82);
      backdrop-filter:blur(6px);
      opacity:0;
      pointer-events:none;
      transition:opacity .24s ease;
    }

    .overlay:not(.show){
      backdrop-filter:none;
    }

    .overlay.show{ opacity:1; pointer-events:auto; }

    .card{
      width:min(600px, 92%);
      border-radius:30px;
      border:2px solid #ffffffde;
      padding:
        calc(24px * var(--ui-scale))
        calc(24px * var(--ui-scale))
        calc(18px * var(--ui-scale));
      background:
        radial-gradient(120% 60% at 0% 0%, #ffffffd8 0%, transparent 46%),
        linear-gradient(180deg, #fffdf4f8, #ffefd2ef 72%, #ffe5f0eb 100%);
      box-shadow:var(--shadow-strong);
      color:var(--shell-ink);
      text-align:center;
      line-height:var(--text-leading);
      overflow:auto;
      max-height:calc(100% - 28px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      -webkit-overflow-scrolling:touch;
    }

    .title{
      margin:0 0 calc(10px * var(--ui-scale));
      font-size:calc(35px * var(--title-scale));
      line-height:1.1;
      color:#ff4e94;
      letter-spacing:.6px;
      text-shadow:0 3px 0 #ffffffd6;
    }

    .title[data-title-role="brand"],
    .title:not([data-title-role]){
      font-family:var(--font-family-heading-brand);
      font-weight:var(--font-weight-heading-brand);
      font-size:calc(42px * var(--title-scale));
    }

    .title[data-title-role="brand"]{
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .start-logo{
      display:block;
      width:calc(810px * var(--title-scale));
      max-width:min(82%, 1170px);
      height:auto;
      margin-inline:auto;
      filter:drop-shadow(0 3px 0 #ffffffd2);
    }

    .title[data-title-role="sub"],
    .pause-title{
      font-family:var(--font-family-heading-sub);
      font-weight:var(--font-weight-heading-sub);
    }

    .subtitle{
      margin:0 0 calc(14px * var(--ui-scale));
      font-size:calc(16px * var(--ui-scale));
      line-height:var(--font-line-height-body);
      font-weight:var(--font-weight-body);
      color:#2f4b69;
    }

    .how{
      margin:0 0 calc(18px * var(--ui-scale));
      padding:calc(14px * var(--ui-scale)) calc(16px * var(--ui-scale));
      border-radius:20px;
      border:2px dashed #ffca7f;
      background:
        linear-gradient(90deg, #ffe5f2d9 0%, #fff1d5e0 45%, #e5ffdbe0 100%);
      font-size:calc(15px * var(--ui-scale));
      font-weight:var(--font-weight-body);
      line-height:var(--font-line-height-body);
      color:#29435f;
    }

    .stack{
      display:flex;
      gap:calc(10px * var(--ui-scale));
      flex-wrap:wrap;
      justify-content:center;
      margin-top:calc(8px * var(--ui-scale));
    }

    .stack button{
      padding:calc(12px * var(--ui-scale)) calc(20px * var(--ui-scale));
    }

    #startBtn{
      background:linear-gradient(100deg, #ff67ad 0%, #ffb34c 50%, #ffe479 100%);
      color:#1f2f4b;
    }

    #soundBtn{
      background:linear-gradient(180deg, #f2f9ff, #dff1ff);
      color:#204463;
    }

    .note{
      font-size:calc(12px * var(--ui-scale));
      font-weight:var(--font-weight-body);
      color:#496683;
      opacity:.84;
      margin-top:calc(10px * var(--ui-scale));
      line-height:var(--font-line-height-body);
    }

    :root[data-device="mobile"] .hud{
      grid-template-columns:1fr;
      gap:8px;
    }

    :root[data-device="mobile"] .hud-main{
      grid-template-columns:repeat(2, minmax(0,1fr));
    }

    :root[data-device="mobile"] .hud-side{
      justify-items:stretch;
    }

    :root[data-device="mobile"] .btns{
      justify-content:space-between;
      width:100%;
    }

    :root[data-device="mobile"] .badge{
      justify-self:flex-start;
      max-width:100%;
    }

    :root[data-device="mobile"] .wrap,
    :root[data-device="mobile"] .stat-card,
    :root[data-device="mobile"] .overlay{
      backdrop-filter:none;
    }

    :root[data-quality-tier="balanced"] body::before,
    :root[data-quality-tier="balanced"] body::after,
    :root[data-quality-tier="performance"] body::before,
    :root[data-quality-tier="performance"] body::after{
      animation:none;
      opacity:.26;
      filter:none;
    }

    :root[data-quality-tier="performance"] .wrap::before{
      mix-blend-mode:normal;
      opacity:.35;
    }

    @media (max-width: 980px) {
      .wrap{
        width:min(100vw, 980px);
      }

      .hud-main{
        gap:8px;
      }

      .stat-card{
        min-height:calc(66px * var(--hud-scale));
      }
    }

    @media (max-width: 700px) {
      body{ place-items:stretch; }

      .wrap{
        width:100vw;
        height:100dvh;
        aspect-ratio:auto;
        border-radius:0;
      }

      .hud-main{
        grid-template-columns:repeat(2, minmax(0,1fr));
        gap:6px;
      }

      .stat-card{
        border-radius:16px;
        padding:8px 9px;
      }

      .stat-label{
        font-size:11px;
      }

      .stat-value{
        font-size:24px;
      }

      .life-heart{
        width:22px;
        height:22px;
      }

      .btns button{
        flex:1 1 auto;
      }

      .card{
        width:min(640px, 95vw);
      }

      .start-logo{
        max-width:min(88%, 1035px);
      }
    }

    @keyframes skyDrift{
      0%{ transform:translateX(0px); }
      50%{ transform:translateX(12px); }
      100%{ transform:translateX(0px); }
    }

    @keyframes feverBadgePulse{
      0%,100%{ transform:scale(1); filter:saturate(1); }
      50%{ transform:scale(1.03); filter:saturate(1.12); }
    }

    @keyframes scoreFeverGlow{
      0%,100%{ transform:translateY(0); filter:saturate(1); }
      50%{ transform:translateY(-1px); filter:saturate(1.16); }
    }

    @keyframes scoreAuraPulse{
      0%,100%{ transform:scale(1); filter:saturate(1); }
      50%{ transform:scale(1.02); filter:saturate(1.14); }
    }

    @keyframes lifeHitPulse{
      0%{ transform:scale(1); }
      30%{ transform:scale(1.3); }
      70%{ transform:scale(.92); }
      100%{ transform:scale(1); }
    }

    @keyframes hudDamageShake{
      0%,100%{ transform:translate3d(0,0,0); }
      20%{ transform:translate3d(-6px,0,0); }
      40%{ transform:translate3d(5px,-1px,0); }
      60%{ transform:translate3d(-4px,1px,0); }
      80%{ transform:translate3d(3px,0,0); }
    }

    .wrap.damage-1{
      animation:hudDamageShake .26s ease-out;
    }

    .wrap.damage-2{
      animation:hudDamageShake .34s ease-out;
      filter:saturate(1.08);
    }

    .wrap.damage-3{
      animation:hudDamageShake .42s ease-out;
      filter:saturate(1.15);
    }

    .wrap.life-caution{
      box-shadow:
        0 0 0 1px rgba(255,169,106,.35) inset,
        var(--shadow-strong);
    }

    .wrap.life-critical{
      box-shadow:
        0 0 0 2px rgba(255,104,152,.46) inset,
        0 0 24px rgba(255,98,156,.26),
        var(--shadow-strong);
    }

    .hearts.life-critical .life-heart.on{
      animation:lifeCriticalAlarm 1.08s ease-in-out infinite;
    }

    @keyframes lifeCriticalAlarm{
      0%,100%{
        transform:scale(1);
        filter:saturate(1);
      }
      50%{
        transform:scale(1.1);
        filter:saturate(1.25);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      body::before,
      body::after,
      .badge.fever-neon{
        animation:none !important;
      }

      .overlay,
      button,
      #score{
        transition:none;
      }

      .score-card.is-fever,
      .score-card.is-fever .score-shell::before{
        animation:none !important;
      }
    }
